!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.returnExports=t(e.jQuery)}(this,function($,e){"use strict";var t={BACKSPACE:8,TAB:9,ENTER:13,ESCAPE:27,ARROW_UP:38,ARROW_DOWN:40},n=null,o="tokenize",s=function(e,t){if(!t.data(o)){var n=new $.tokenize($.extend({},$.fn.tokenize.defaults,e));t.data(o,n),n.init(t)}return t.data(o)};$.tokenize=function(t){t==e&&(t=$.fn.tokenize.defaults),this.options=t},$.extend($.tokenize.prototype,{init:function(e){var t=this;this.select=e.attr("multiple","multiple").css({margin:0,padding:0,border:0}).hide(),this.container=$("<div />").attr("class",this.select.attr("class")).addClass("Tokenize"),1==this.options.maxElements&&this.container.addClass("OnlyOne"),this.dropdown=$("<ul />").addClass("Dropdown"),this.tokensContainer=$("<ul />").addClass("TokensContainer"),this.options.autosize&&this.tokensContainer.addClass("Autosize"),this.searchToken=$("<li />").addClass("TokenSearch").appendTo(this.tokensContainer),this.searchInput=$("<input />").appendTo(this.searchToken),this.options.searchMaxLength>0&&this.searchInput.attr("maxlength",this.options.searchMaxLength),this.select.prop("disabled")&&this.disable(),this.options.sortable&&("undefined"!=typeof $.ui?this.tokensContainer.sortable({items:"li.Token",cursor:"move",placeholder:"Token MovingShadow",forcePlaceholderSize:!0,update:function(){t.updateOrder()},start:function(){t.searchToken.hide()},stop:function(){t.searchToken.show()}}).disableSelection():(this.options.sortable=!1,console.error("jQuery UI is not loaded, sortable option has been disabled"))),this.container.append(this.tokensContainer).append(this.dropdown).insertAfter(this.select),this.tokensContainer.on("click",function(e){e.stopImmediatePropagation(),t.searchInput.get(0).focus(),t.updatePlaceholder(),t.dropdown.is(":hidden")&&""!=t.searchInput.val()&&t.search()}),this.searchInput.on("blur",function(){t.tokensContainer.removeClass("Focused")}),this.searchInput.on("focus click",function(){t.tokensContainer.addClass("Focused"),t.options.displayDropdownOnFocus&&"select"==t.options.datas&&t.search()}),this.searchInput.on("keydown",function(e){t.resizeSearchInput(),t.keydown(e)}),this.searchInput.on("keyup",function(e){t.keyup(e)}),this.searchInput.on("keypress",function(e){t.keypress(e)}),this.searchInput.on("paste",function(){setTimeout(function(){t.resizeSearchInput()},10),setTimeout(function(){var e=t.searchInput.val().split(",");e.length>1&&$.each(e,function(e,n){t.tokenAdd(n.trim(),"")})},20)}),$(document).on("click",function(){t.dropdownHide(),1==t.options.maxElements&&t.searchInput.val()&&t.tokenAdd(t.searchInput.val(),"")}),this.resizeSearchInput(),this.remap(!0),this.updatePlaceholder()},updateOrder:function(){if(this.options.sortable){var t,n,o=this;$.each(this.tokensContainer.sortable("toArray",{attribute:"data-value"}),function(s,i){n=$('option[value="'+i+'"]',o.select),t==e?n.prependTo(o.select):t.after(n),t=n}),this.options.onReorder(this)}},updatePlaceholder:function(){this.options.placeholder&&(this.placeholder==e&&(this.placeholder=$("<li />").addClass("Placeholder").html(this.options.placeholder),this.placeholder.insertBefore($("li:first-child",this.tokensContainer))),0==this.searchInput.val().length&&0==$("li.Token",this.tokensContainer).length?this.placeholder.show():this.placeholder.hide())},dropdownShow:function(){this.dropdown.show(),this.options.onDropdownShow(this)},dropdownPrev:function(){$("li.Hover",this.dropdown).length>0?$("li.Hover",this.dropdown).is("li:first-child")?($("li.Hover",this.dropdown).removeClass("Hover"),$("li:last-child",this.dropdown).addClass("Hover")):$("li.Hover",this.dropdown).removeClass("Hover").prev().addClass("Hover"):$("li:first",this.dropdown).addClass("Hover")},dropdownNext:function(){$("li.Hover",this.dropdown).length>0?$("li.Hover",this.dropdown).is("li:last-child")?($("li.Hover",this.dropdown).removeClass("Hover"),$("li:first-child",this.dropdown).addClass("Hover")):$("li.Hover",this.dropdown).removeClass("Hover").next().addClass("Hover"):$("li:first",this.dropdown).addClass("Hover")},dropdownAddItem:function(e,t,n){if(n=n||t,!$('li[data-value="'+e+'"]',this.tokensContainer).length){var o=this,s=$("<li />").attr("data-value",e).attr("data-text",t).html(n).on("click",function(e){e.stopImmediatePropagation(),o.tokenAdd($(this).attr("data-value"),$(this).attr("data-text"))}).on("mouseover",function(){$(this).addClass("Hover")}).on("mouseout",function(){$("li",o.dropdown).removeClass("Hover")});this.dropdown.append(s),this.options.onDropdownAddItem(e,t,n,this)}return this},dropdownHide:function(){this.dropdownReset(),this.dropdown.hide()},dropdownReset:function(){this.dropdown.html("")},resizeSearchInput:function(){this.searchInput.attr("size",Number(this.searchInput.val().length)+5),this.updatePlaceholder()},resetSearchInput:function(){this.searchInput.val(""),this.resizeSearchInput()},resetPendingTokens:function(){$("li.PendingDelete",this.tokensContainer).removeClass("PendingDelete")},keypress:function(e){var t=!1;Array.isArray(this.options.delimiter)?this.options.delimiter.indexOf(String.fromCharCode(e.which))>=0&&(t=!0):String.fromCharCode(e.which)==this.options.delimiter&&(t=!0),t&&(e.preventDefault(),this.tokenAdd(this.searchInput.val(),""))},keydown:function(e){switch(e.keyCode){case t.BACKSPACE:0==this.searchInput.val().length&&(e.preventDefault(),$("li.Token.PendingDelete",this.tokensContainer).length?this.tokenRemove($("li.Token.PendingDelete").attr("data-value")):$("li.Token:last",this.tokensContainer).addClass("PendingDelete"),this.dropdownHide());break;case t.TAB:case t.ENTER:if($("li.Hover",this.dropdown).length){var n=$("li.Hover",this.dropdown);e.preventDefault(),this.tokenAdd(n.attr("data-value"),n.attr("data-text"))}else this.searchInput.val()&&(e.preventDefault(),this.tokenAdd(this.searchInput.val(),""));this.resetPendingTokens();break;case t.ESCAPE:this.resetSearchInput(),this.dropdownHide(),this.resetPendingTokens();break;case t.ARROW_UP:e.preventDefault(),this.dropdownPrev();break;case t.ARROW_DOWN:e.preventDefault(),this.dropdownNext();break;default:this.resetPendingTokens()}},keyup:function(e){switch(this.updatePlaceholder(),e.keyCode){case t.TAB:case t.ENTER:case t.ESCAPE:case t.ARROW_UP:case t.ARROW_DOWN:break;case t.BACKSPACE:this.searchInput.val()?this.search():this.dropdownHide();break;default:this.searchInput.val()&&this.search()}},search:function(){var e=this,t=1;if(this.options.maxElements>0&&$("li.Token",this.tokensContainer).length>=this.options.maxElements||this.searchInput.val().length<this.options.searchMinLength)return!1;if("select"==this.options.datas){var n=!1,o=new RegExp(this.searchInput.val().replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i");this.dropdownReset(),$("option",this.select).not(":selected, :disabled").each(function(){return t<=e.options.nbDropdownElements?void(o.test($(this).html())&&(e.dropdownAddItem($(this).attr("value"),$(this).html()),n=!0,t++)):!1}),n?($("li:first",this.dropdown).addClass("Hover"),this.dropdownShow()):this.dropdownHide()}else this.debounce(function(){$.ajax({url:e.options.datas,data:e.options.searchParam+"="+encodeURIComponent(e.searchInput.val()),dataType:e.options.dataType,success:function(n){return n&&(e.dropdownReset(),$.each(n,function(n,o){if(!(t<=e.options.nbDropdownElements))return!1;var s;o[e.options.htmlField]&&(s=o[e.options.htmlField]),e.dropdownAddItem(o[e.options.valueField],o[e.options.textField],s),t++}),$("li",e.dropdown).length)?($("li:first",e.dropdown).addClass("Hover"),e.dropdownShow(),!0):void e.dropdownHide()},error:function(t,n){e.options.onAjaxError(e,t,n)}})},this.options.debounce)},debounce:function(e,t){var o=this,s=arguments,i=function(){e.apply(o,s),n=null};n&&clearTimeout(n),n=setTimeout(i,t||this.options.debounce)},tokenAdd:function(t,n,o){if(t=this.escape(t).trim(),t==e||""==t)return this;if(n=n||t,o=o||!1,this.options.maxElements>0&&$("li.Token",this.tokensContainer).length>=this.options.maxElements)return this.resetSearchInput(),this;var s=this,i=$("<a />").addClass("Close").html("&#215;").on("click",function(e){e.stopImmediatePropagation(),s.tokenRemove(t)});if($('option[value="'+t+'"]',this.select).length)o||$('option[value="'+t+'"]',this.select).attr("selected")!==!0&&$('option[value="'+t+'"]',this.select).prop("selected")!==!0||this.options.onDuplicateToken(t,n,this),$('option[value="'+t+'"]',this.select).attr("selected",!0).prop("selected",!0);else{if(!(this.options.newElements||!this.options.newElements&&$('li[data-value="'+t+'"]',this.dropdown).length>0))return this.resetSearchInput(),this;var a=$("<option />").attr("selected",!0).attr("value",t).attr("data-type","custom").prop("selected",!0).html(n);this.select.append(a)}return $('li.Token[data-value="'+t+'"]',this.tokensContainer).length>0?this:($("<li />").addClass("Token").attr("data-value",t).append("<span>"+n+"</span>").prepend(i).insertBefore(this.searchToken),o||this.options.onAddToken(t,n,this),this.resetSearchInput(),this.dropdownHide(),this.updateOrder(),this)},tokenRemove:function(e){var t=$('option[value="'+e+'"]',this.select);return"custom"==t.attr("data-type")?t.remove():t.removeAttr("selected").prop("selected",!1),$('li.Token[data-value="'+e+'"]',this.tokensContainer).remove(),this.options.onRemoveToken(e,this),this.resizeSearchInput(),this.dropdownHide(),this.updateOrder(),this},clear:function(){var e=this;return $("li.Token",this.tokensContainer).each(function(){e.tokenRemove($(this).attr("data-value"))}),this.options.onClear(this),this.dropdownHide(),this},disable:function(){return this.select.prop("disabled",!0),this.searchInput.prop("disabled",!0),this.container.addClass("Disabled"),this.options.sortable&&this.tokensContainer.sortable("disable"),this},enable:function(){return this.select.prop("disabled",!1),this.searchInput.prop("disabled",!1),this.container.removeClass("Disabled"),this.options.sortable&&this.tokensContainer.sortable("enable"),this},remap:function(e){var t=this,n=$("option:selected",this.select);return e=e||!1,this.clear(),n.each(function(){t.tokenAdd($(this).val(),$(this).html(),e)}),this},toArray:function(){var e=[];return $("option:selected",this.select).each(function(){e.push($(this).val())}),e},escape:function(e){var t=document.createElement("div");return t.innerHTML=e,e=t.textContent||t.innerText||"",String(e).replace(/["]/g,function(){return""})}}),$.fn.tokenize=function(e){e=e||{};var t=this.filter("select");if(t.length>1){var n=[];return t.each(function(){n.push(s(e,$(this)))}),n}return s(e,$(this))},$.fn.tokenize.defaults={datas:"select",placeholder:!1,searchParam:"search",searchMaxLength:0,searchMinLength:0,debounce:0,delimiter:",",newElements:!0,autosize:!1,nbDropdownElements:10,displayDropdownOnFocus:!1,maxElements:0,sortable:!1,dataType:"json",valueField:"value",textField:"text",htmlField:"html",onAddToken:function(e,t,n){},onRemoveToken:function(e,t){},onClear:function(e){},onReorder:function(e){},onDropdownAddItem:function(e,t,n,o){},onDropdownShow:function(e){},onDuplicateToken:function(e,t,n){},onAjaxError:function(e,t,n){}}});